$((function(){function t(t){var e=$("#expenseItemTable").data("url");$.ajax({url:e,type:"GET",dataType:"json",success:function(e){var n='<option value="" selected>Choose Expense Category</option>';e.forEach((function(t){n+='<option value="'.concat(t.id,'" class="text-primary">').concat(t.name,"</option>"),t.children&&t.children.forEach((function(t){n+='<option value="'.concat(t.id,'" class="text-success">— ').concat(t.name,"</option>"),t.children&&t.children.forEach((function(t){n+='<option value="'.concat(t.id,'" class="text-dark">—— ').concat(t.name,"</option>")}))}))})),t(n)},error:function(){alert("Failed to load expense categories.")}})}t((function(t){$(".expense-category").each((function(){$(this).html(t)}))})),$("#addRow").click((function(e){e.preventDefault();var n=$("#expenseItemTable tbody tr").length,o="<tr>\n            <td>".concat(n+1,'</td>\n            <td>\n                <input type="text" name="items[').concat(n,'][name]" class="form-control mt-1" placeholder="Item Name" />\n                <small class="text-danger error error-items-').concat(n,'-name"></small>\n            </td>\n            <td>\n                <select name="items[').concat(n,'][category]" class="form-select mt-1 form-control expense-category">\n                    <option value="" selected>Choose Expense Category</option>\n                </select>\n                <small class="text-danger error error-items-').concat(n,'-category"></small>\n            </td>\n            <td>\n                <input type="text" name="items[').concat(n,'][quantity]" class="form-control mt-1" placeholder="Quantity" />\n                <small class="text-danger error error-items-').concat(n,'-quantity"></small>\n            </td>\n            <td>\n                <input type="text" name="items[').concat(n,'][rate]" class="form-control mt-1" placeholder="Rate" />\n                <small class="text-danger error error-items-').concat(n,'-rate"></small>\n            </td>\n            <td><button type="button" class="btn btn-danger btn-sm removeRow">Remove</button></td>\n        </tr>');$("#expenseItemTable tbody").append(o),t((function(t){$("#expenseItemTable tbody tr:last .expense-category").html(t)}))})),$(document).on("click",".removeRow",(function(){$(this).closest("tr").remove(),$("#expenseItemTable tbody tr").each((function(t){$(this).find("td:first").text(t+1),$(this).find("input, select").each((function(){var e=$(this).attr("name");if(e){var n=e.replace(/\[\d+\]/,"[".concat(t,"]"));$(this).attr("name",n)}}))})),$("#expenseItemTable tbody tr").length})),$("#addExpenseForm").on("submit",(function(t){t.preventDefault();var e=$(this),n=e.find("button[type='submit']"),o=new FormData(this),a=e.attr("action");n.prop("disabled",!0).text("Saving..."),$(".error").text(""),$.ajax({url:a,type:"POST",data:o,processData:!1,contentType:!1,success:function(t){alert("Expense recorded successfully!"),window.location.reload()},error:function(t){var e=t.responseJSON.errors;console.log(t.responseJSON.errors),$.each(e,(function(t,e){var n=t.replace(/_/g,"-"),o=".error-".concat(n);if(t.startsWith("items.")){var a=t.match(/\d+/)[0],r=t.split(".").pop(),c=".error-items-".concat(a,"-").concat(r);$(c).text(e[0])}else"items"===t?($(".error-items").text(e[0]),console.log(e)):$(o).text(e[0]);alert(e)})),n.prop("disabled",!1).text("Save Expense")}})}))}));